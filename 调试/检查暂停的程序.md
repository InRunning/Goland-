# 检查暂停的程序

调试会话器启动后，将出现[调试](https://www.jetbrains.com/help/go/debug-tool-window.html)工具窗口，然后直到下面之一的情况发生程序都会正常运行：

1. 一个[断点](断点.md)被命中
2. 你手动暂停程序

然后，程序被暂停了，这能让你检查它的当前状态，控制其进一步执行，并在运行时测试多种场景。

> 如果你不小心关闭了**调试**工具窗口，在主菜单中选择**视图|工具窗口|调试**或按`Alt+5`去重新打开它。

## 检查帧

程序的状态将由 *帧* 表示。当程序被暂停时，当前帧栈将会**调试**窗口在**帧**（**Frames**）的标签页展示。

![帧的标签页](https://resources.jetbrains.com/help/img/idea/2021.3/go_debug_examining_frames_tab.png)

帧对应于活动的方法或函数调用。它存储被调用方法或函数的本地变量，参数，和能够计算表达式代码上下文。

为了更好地了解帧的概念，让我们看看程序运行时会发生什么。程序从`main`函数开始执行，`main`方法反过来调用其它方法。这些方法中的每一个都可以进行更多的方法调用。每个方法调用的局部变量和参数的集合由帧表示。每当一个方法被调用，一个新的帧被加入到栈顶。当方法执行结束，相应的帧将会被从栈移除（用的后入先出风格）。

检查帧帮助你理解为什么特定的参数会被传递到方法和调用者在调用时的状态。

> #### 复制栈到剪贴板
>
> - 为了复制调用栈到当前线程，右键帧标签的任何地方并选择**复制栈**（**Copy Stack**）。

> #### 在一个标签页中连续预览帧
>
> 预览标签允许你在一个标签页中成功打开多个文件。这样可以避免在单独的选项卡中使用多个打开的文件使编辑器变得混乱。
>
> - 要为调试期间打开的文件启用预览模式，请按Ctrl+Alt+S打开设置，导航到**编辑器|常规|编辑器选项卡**（**Editor|General|Editor Tabs**），然后选中**启用预览选项卡**(**Enable preview tab**)复选框。
>
>   ![预览选项卡](https://resources.jetbrains.com/help/img/idea/2021.3/go_debugger_the_preview_tab.animated.gif)

> #### 隐藏对象类型
>
> 如果对象类型在**调试**（**Debug**)工具窗口占据了太多空间，右键一个变量并清除显示列表中的**显示类型**（**Show Types**)选项。
>
> ![调试窗口](https://resources.jetbrains.com/help/img/idea/2021.3/go_debug_hide_object_types.png)

## 在转储（dump）选项卡中筛选goroutines列表

你可以转储（dump）你程序使用的所有的goroutines，应用搜索特定goroutine的筛选器，并研究过滤结果。此过程能帮助你更好了解你的程序或其部分是如何工作的。

例如，下面的截图显示了`Goroutine 7 main.pageSize`的执行栈。goroutines列表中的一个groutine名字是'Goroutine<ID> <last_non-runtime_function_on_the_stack>'。非运行时意味着这个函数没有在运行包中。

![dump goroutine](https://resources.jetbrains.com/help/img/idea/2021.3/go_execution_stack.png)

> #### 转储（Dump）goroutines
>
> 在一个调试器会话中，点击**转储 Groutines**（**Dump Goroutines**）按钮（![dump goroutine button](https://resources.jetbrains.com/help/img/idea/2021.3/icons.actions.dump.svg)）。
>
> 一个可用的goroutines的转储和它们的栈将会在一个单独选项中打开。
>
> ![dump goroutines](https://resources.jetbrains.com/help/img/idea/2021.3/go_dump_goroutines.png)

> #### 过滤转储结果
>
> - 点击**过滤**（**Filter**）图标（![过滤图标]https://resources.jetbrains.com/help/img/idea/2021.3/icons.general.filter.svg))， 输入你想要搜索的字符串。
>
>   ![过滤](https://resources.jetbrains.com/help/img/idea/2021.3/go_using_filter_icon.png)
>
> - 右键你想要从列表中排除的goroutine并选择**隐藏goroutine**，要隐藏所有和选择的goroutine由相同栈的gotoutine，从上下文菜单中选择**隐藏有相同栈的goroutine**（**Hide goroutines with the same stack**)。
>
>   你能在**隐藏**（**Hidden**）列表中看到被隐藏的goroutine
>
>   要重置列表的状态并使全部隐藏的goroutines再次显示在可见列表中，点击**重置隐藏Goroutine**（**Reset Hidden Goroutines**）按钮（![重置按钮](https://resources.jetbrains.com/help/img/idea/2021.3/icons.general.reset.svg))
>
>   ![隐藏有相同栈的goroutine](https://resources.jetbrains.com/help/img/idea/2021.3/go_hide_goroutine.png)

> #### 将转储结果导出到文本文件中
>
> 1. 点击**导出到文本文件**（**Export to Text File**)图标（![导出图标](https://resources.jetbrains.com/help/img/idea/2021.3/icons.toolbarDecorator.export.svg))
> 2. 在**导出到文件**（**Export to File**)视图中，选择存储路径并点击**保存**（**Save**）。
>
> ![导出到文件视图](https://resources.jetbrains.com/help/img/idea/2021.3/go_export_dump_results_into_a_text_file.png)

## 检查/更新变量

变量选项卡显示被选择的[帧/线程](#检查帧)。对变量的了解有助于理解程序为何以某种方式运行。

![变量选项卡](https://resources.jetbrains.com/help/img/idea/2021.3/go_debug_examining_variables_panel.png)

> 注意变量的作用域和生命周期。如果一个变量不在列表中，这表示该变量在当前执行点跳出了当前帧的作用域。

每个变量左侧的图标指示其类型

### 变量类型

> #### 复制变量
>
> 当检查变量时，你可能需要复制变量名或值去粘贴它到某个地方或与其它变量比较
>
> - 要复制一个变量拥有的值，右键变量并选择**复制值**（**Copy Value**）`Ctrl+C`
> - 要复制一个变量名，右键变量并选择**复制名**（**Copy Name**）

> #### 用剪贴板比较变量
>
> 当你需要将变量值与其它值比较时，使用**用剪贴板比较变量**（**Compare Value With Clipboard**)选项。这是非常有用的，例如，当你的变量有很长的字符串，并且你需要与其它长字符串进行对比。
>
> 1. 复制你将要对比的内容（例如，从一个文本文件中）
>
>    ![复制变量值](https://resources.jetbrains.com/help/img/idea/2021.3/debug_examining_compare_1.png)
>
> 2. 在**变量**（**Varables**）选项卡中，右键你想要对比的的变量并选择**用剪贴板比较值**（**Compare Value with Clipboard**)。
>
> 3. 在打开的 Diff Viewer 中检查差异，为了获取更多信息来高效使用 Diff Viewer，参考[比较文件和文件夹](https://www.jetbrains.com/help/go/comparing-files-and-folders.html)的主题。
>
>    ![Diff Viewer](https://resources.jetbrains.com/help/img/idea/2021.3/debug_examining_compare_2.png)

> #### 在专用对话框中查看变量
>
> Goland 允许你在一个专用对话框中检查变量，当你需要追踪某些变量（或其引用的对象）并且同时在帧和goroutine 中跳转，这将是非常有用的。
>
> - 在变量选项卡中右键变量并选择**检查**（**inspect**）
>
>   ![检查变量](https://resources.jetbrains.com/help/img/idea/2021.3/debug_examining_inspect_dialog.png)

> #### 设置变量值
>
> 如果需要测试在特定条件下程序如何表现或在运行时修复其当前行为，你可以通过设置/改变变量值来做到。
>
> 1. 在变量选项卡右键变量并选择设置变量，或选择变量并按`F2`。
> 2. 输入变量值并按`Enter`。
>
> 或者，你可以使用[内联](https://www.jetbrains.com/help/go/examining-suspended-program.html#inline-view)提示弹出窗口设置变量值。单机与所需变量对应的提示，根据需要展开树，然后选择**设置值**(**Set Value**):
>
> ![提示弹出窗口设置变量值](https://resources.jetbrains.com/help/img/idea/2021.3/go_debug_interactive_inline_hint_setvalue.png)

> #### 导航到源代码
>
> 如果你需要查看声明某些变量或类型的源代码，则可以从**变量**（**Variables**）选项卡移到那里。
>
> - 要移动到生命变量的代码，右键变量并选择**跳转到源代码**（**Jump to Source**）`F4`。
>
>   ![跳转到源代码](https://resources.jetbrains.com/help/img/idea/2021.3/go_debug_examining_jump_to_source.png)
>
> - 要跳转到变量类型声明的源代码，右键变量并选择**跳转到类型源码**（**Jump to Type Source**)`F4`。
>
>   ![跳转到类型声明源码](https://resources.jetbrains.com/help/img/idea/2021.3/go_debug_examining_jump_to_type.png)

## 计算表达式

Goland 让你在调试器会话期间计算表达式去获取程序状态的额外信息或测试运行时的多种场景。

> 当计算表达式时，注意变量的作用域和生命周期。所有表达式在当前执行点的上下文中被计算。

### 在编辑器中计算简单表达式



